<?php $GLOBALS['TL_CSS'][] = 'system/modules/fullcalendar/assets/fullcalendar.css||static';?>

<?php $this->extend('block_searchable');?>

<?php $this->block('content');?>

<?php if ($this->errorMessage): ?>
    <pre style="color:red;"><?=$this->errorMessage?></pre>
<?php endif;?>

<div id="calendar_<?=$this->id?>"></div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var events = <?=$this->jsonArrayEvents?>,
        fcMenuElement = document.getElementById("fullcal_menu_<?=$this->id?>"),
        fc = new FullCalendar.Calendar(document.getElementById('calendar_<?=$this->id?>'),
        // Remove last } to extend the json object
        <?=substr_replace($this->fullcalOptions, '', strrpos($this->fullcalOptions, '}'))?>,
        events: events
    });
    fc.render();

    if(fcMenuElement) {
        console.log("fcMenuElement", fcMenuElement);
        var dots = fcMenuElement.getElementsByClassName("fullcal_menu_dot");
        dots && Array.prototype.forEach.call(dots, function(dot) {
            console.log("dot", dot);
        });
    }

});
</script>

<?php if ($this->showMenu): ?>
<div id="fullcal_menu_<?=$this->id?>" class="fullcal_menu">
    <ul class="fullcal_menu_list">
    <?php foreach ($this->arrCalendar as $cal): ?>
        <li id="calAlias_<?=$cal->alias?>" class="fullcal_menu_entry">
            <span class="fullcal_menu_dot" style="background-color:#<?=$cal->color[0]?>"></span>
            <span class="fullcal_menu_label">
                <a class="fullcal_menu_title"><?=$cal->title?></span>, <a class="fullcal_menu_ics" onclick="return false" href="{{fullcal_url::<?=$cal->alias?>}}">{{fullcal_url::<?=$cal->alias?>}}</a>
            </span>
        </li>
    <?php endforeach;?>
    </ul>
</div>
<?php endif;?>

<?php if ($this->appendStyle): ?>
<style>
<?=$this->appendStyle?>
</style>
<?php endif;?>

<?php $this->endblock();?>
